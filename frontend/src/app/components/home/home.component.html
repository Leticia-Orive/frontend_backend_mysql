<div class="home-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1>ğŸ›’ Tienda Online</h1>
      <div class="header-actions">
        <button class="btn-contact" routerLink="/contact">
          ğŸ“§ Contacto
        </button>
        
        <!-- Not logged in -->
        <div *ngIf="!currentUser" class="auth-buttons">
          <button class="btn-login" routerLink="/login">
            ğŸ” Iniciar SesiÃ³n
          </button>
          <button class="btn-register" routerLink="/register">
            ğŸ“ Registrarse
          </button>
        </div>
        
        <!-- Logged in -->
        <div *ngIf="currentUser" class="user-section">
          <span class="welcome-text">
            Hola, {{ currentUser.name }}
            <span class="role-badge" [class.admin]="currentUser.role === 'admin'">
              {{ currentUser.role === 'admin' ? 'Admin' : 'User' }}
            </span>
          </span>
          <button 
            *ngIf="currentUser?.role === 'admin'" 
            class="btn-admin" 
            (click)="goToUsers()">
            ğŸ‘¥ Usuarios
          </button>
          <button class="btn-logout" (click)="logout()">
            ğŸšªCerrar session
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Coupons Notification -->
  <div *ngIf="currentUser && userCoupons.length > 0 && showCouponsNotification" class="coupons-notification">
    <div class="notification-content">
      <button class="btn-close-notification" (click)="showCouponsNotification = false">âœ–</button>
      <div class="notification-icon">ğŸ</div>
      <div class="notification-text">
        <h3>Â¡Tienes {{ userCoupons.length }} cupÃ³n{{ userCoupons.length > 1 ? 'es' : '' }} disponible{{ userCoupons.length > 1 ? 's' : '' }}!</h3>
        <div class="coupon-list">
          <div *ngFor="let coupon of userCoupons" class="coupon-item">
            <span class="coupon-code">{{ coupon.coupon_code }}</span>
            <span class="coupon-amount">â‚¬{{ coupon.discount_amount }}</span>
          </div>
        </div>
        <p class="notification-hint">Ãšsalos en el carrito para obtener descuentos</p>
      </div>
    </div>
  </div>

  <!-- Category Filter -->
  <div class="category-filter">
    <button 
      class="filter-btn" 
      [class.active]="selectedCategory === null"
      (click)="filterByCategory(null)">
      Todas
    </button>
    <button 
      *ngFor="let category of categories"
      class="filter-btn" 
      [class.active]="selectedCategory === category.id"
      (click)="filterByCategory(category.id)">
      {{ category.name }}
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando productos...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <!-- Products by Category -->
  <div *ngIf="!loading && !error" class="products-container">
    <div *ngFor="let category of getFilteredCategories()" class="category-section">
      <div class="category-header">
        <img [src]="category.image_url" [alt]="category.name" class="category-image">
        <div class="category-info">
          <h2>{{ category.name }}</h2>
          <p>{{ category.description }}</p>
        </div>
      </div>

      <!-- Productos de la categorÃ­a principal -->
      <div *ngIf="productsByCategory[category.id]?.length === 0 && (!category.subcategories || category.subcategories.length === 0)" class="no-products">
        No hay productos en esta categorÃ­a
      </div>

      <!-- Add Product Button for Admin -->
      <div *ngIf="isAdmin()" class="add-product-section">
        <button class="btn-add-product" (click)="openCreateProductForm()">
          â• AÃ±adir Nuevo Producto a {{ category.name }}
        </button>
      </div>

      <div *ngIf="productsByCategory[category.id] && productsByCategory[category.id].length > 0" class="products-grid">
        <div *ngFor="let product of productsByCategory[category.id]" class="product-card">
          <div class="product-image-container">
            <img [src]="product.image_url" [alt]="product.name" class="product-image">
            <span *ngIf="product.stock === 0" class="out-of-stock">Agotado</span>
            <span *ngIf="product.stock > 0 && product.stock < 10" class="low-stock">Ãšltimas unidades</span>
          </div>
          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            <p class="product-description">{{ product.description }}</p>
            <div class="product-footer">
              <span class="product-price">{{ product.price | currency:'EUR':'symbol':'1.2-2' }}</span>
              <span class="product-stock">Stock: {{ product.stock }}</span>
            </div>
            
            <!-- Admin Buttons -->
            <div *ngIf="isAdmin()" class="admin-buttons">
              <button class="btn-edit" (click)="openEditProductForm(product)">
                âœï¸ Editar
              </button>
              <button class="btn-delete" (click)="deleteProduct(product)">
                ğŸ—‘ï¸ Eliminar
              </button>
            </div>
            
            <!-- User Buttons (only when logged in and not admin) -->
            <div *ngIf="currentUser && !isAdmin()" class="user-buttons">
              <button class="btn-view-product" (click)="viewProduct(product)">
                ğŸ‘ï¸ Ver Producto
              </button>
            </div>
            
            <!-- Add to Cart Button (for all users) -->
            <button 
              class="btn-add-cart" 
              [disabled]="product.stock === 0"
              [class.disabled]="product.stock === 0"
              (click)="addToCart(product)">
              {{ product.stock === 0 ? 'Agotado' : 'ğŸ›’ AÃ±adir al Carrito' }}
            </button>
          </div>
        </div>
      </div>

      <!-- SubcategorÃ­as y sus productos -->
      <div *ngIf="category.subcategories && category.subcategories.length > 0" class="subcategories-container">
        <div *ngFor="let subcategory of category.subcategories" class="subcategory-section">
          <div class="subcategory-header" (click)="toggleSubcategory(subcategory.id)">
            <img [src]="subcategory.image_url" [alt]="subcategory.name" class="subcategory-image">
            <div class="subcategory-info">
              <h3>{{ subcategory.name }}</h3>
              <p>{{ subcategory.description }}</p>
              <span class="product-count">
                {{ productsByCategory[subcategory.id]?.length || 0 }} productos
              </span>
            </div>
            <div class="expand-icon">
              {{ isSubcategoryExpanded(subcategory.id) ? 'â–¼' : 'â–¶' }}
            </div>
          </div>

          <div *ngIf="isSubcategoryExpanded(subcategory.id)" class="subcategory-content">
            <div *ngIf="productsByCategory[subcategory.id]?.length === 0" class="no-products">
              No hay productos en esta subcategorÃ­a
            </div>

            <div *ngIf="productsByCategory[subcategory.id] && productsByCategory[subcategory.id].length > 0" class="products-grid">
            <div *ngFor="let product of productsByCategory[subcategory.id]" class="product-card">
              <div class="product-image-container">
                <img [src]="product.image_url" [alt]="product.name" class="product-image">
                <span *ngIf="product.stock === 0" class="out-of-stock">Agotado</span>
                <span *ngIf="product.stock > 0 && product.stock < 10" class="low-stock">Ãšltimas unidades</span>
              </div>
              <div class="product-info">
                <h3 class="product-name">{{ product.name }}</h3>
                <p class="product-description">{{ product.description }}</p>
                <div class="product-footer">
                  <span class="product-price">{{ product.price | currency:'EUR':'symbol':'1.2-2' }}</span>
                  <span class="product-stock">Stock: {{ product.stock }}</span>
                </div>
                
                <div *ngIf="isAdmin()" class="admin-buttons">
                  <button class="btn-edit" (click)="openEditProductForm(product)">
                    âœï¸ Editar
                  </button>
                  <button class="btn-delete" (click)="deleteProduct(product)">
                    ğŸ—‘ï¸ Eliminar
                  </button>
                </div>
                
                <div *ngIf="currentUser && !isAdmin()" class="user-buttons">
                  <button class="btn-view-product" (click)="viewProduct(product)">
                    ğŸ‘ï¸ Ver Producto
                  </button>
                </div>
                
                <button 
                  class="btn-add-cart" 
                  [disabled]="product.stock === 0"
                  [class.disabled]="product.stock === 0"
                  (click)="addToCart(product)">
                  {{ product.stock === 0 ? 'Agotado' : 'ğŸ›’ AÃ±adir al Carrito' }}
                </button>
              </div>
            </div>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Form Modal (Admin Only) -->
  <div *ngIf="showProductForm" class="modal-overlay" (click)="closeProductForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>{{ isEditingProduct ? 'Editar Producto' : 'Nuevo Producto' }}</h2>
      
      <div class="form-group">
        <label>Nombre *</label>
        <input type="text" [(ngModel)]="currentProduct.name" placeholder="Nombre del producto">
      </div>

      <div class="form-group">
        <label>DescripciÃ³n</label>
        <textarea [(ngModel)]="currentProduct.description" placeholder="DescripciÃ³n del producto"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Precio (â‚¬) *</label>
          <input type="number" [(ngModel)]="currentProduct.price" placeholder="0.00" step="0.01">
        </div>

        <div class="form-group">
          <label>Stock *</label>
          <input type="number" [(ngModel)]="currentProduct.stock" placeholder="0">
        </div>
      </div>

      <div class="form-group">
        <label>CategorÃ­a *</label>
        <select [(ngModel)]="currentProduct.category_id">
          <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
        </select>
      </div>

      <div class="form-group">
        <label>URL de la Imagen</label>
        <input type="text" [(ngModel)]="currentProduct.image_url" placeholder="https://...">
      </div>

      <div class="form-actions">
        <button class="btn-cancel" (click)="closeProductForm()">Cancelar</button>
        <button class="btn-save" (click)="saveProduct()">
          {{ isEditingProduct ? 'Actualizar' : 'Crear' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Product Detail Modal -->
  <div *ngIf="showProductDetail && selectedProduct" class="modal-overlay" (click)="closeProductDetail()">
    <div class="modal-content product-detail-modal" (click)="$event.stopPropagation()">
      <button class="btn-close-modal" (click)="closeProductDetail()">âœ•</button>
      
      <div class="product-detail-content">
        <div class="product-detail-image">
          <img [src]="selectedProduct.image_url" [alt]="selectedProduct.name">
          <span *ngIf="selectedProduct.stock === 0" class="badge-out-of-stock">Agotado</span>
          <span *ngIf="selectedProduct.stock > 0 && selectedProduct.stock < 10" class="badge-low-stock">
            Â¡Solo quedan {{ selectedProduct.stock }}!
          </span>
        </div>
        
        <div class="product-detail-info">
          <h2>{{ selectedProduct.name }}</h2>
          
          <div class="product-category-badge">
            ğŸ“¦ {{ selectedProduct.category_name }}
          </div>
          
          <div class="product-price-section">
            <span class="price-label">Precio:</span>
            <span class="price-value">{{ selectedProduct.price | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          
          <div class="product-description-full">
            <h3>DescripciÃ³n</h3>
            <p>{{ selectedProduct.description }}</p>
          </div>
          
          <div class="product-specifications">
            <h3>Especificaciones</h3>
            <div class="spec-item">
              <span class="spec-label">ğŸ“¦ Stock disponible:</span>
              <span class="spec-value">{{ selectedProduct.stock }} unidades</span>
            </div>
            <div class="spec-item">
              <span class="spec-label">ğŸ·ï¸ CategorÃ­a:</span>
              <span class="spec-value">{{ selectedProduct.category_name }}</span>
            </div>
            <div class="spec-item">
              <span class="spec-label">ğŸ†” ID del producto:</span>
              <span class="spec-value">#{{ selectedProduct.id }}</span>
            </div>
            <div class="spec-item" *ngIf="selectedProduct.created_at">
              <span class="spec-label">ğŸ“… Fecha de publicaciÃ³n:</span>
              <span class="spec-value">{{ selectedProduct.created_at | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>
          
          <div class="product-actions">
            <button 
              class="btn-add-to-cart-detail" 
              [disabled]="selectedProduct.stock === 0"
              [class.disabled]="selectedProduct.stock === 0"
              (click)="addToCartFromDetail()">
              {{ selectedProduct.stock === 0 ? 'âŒ Producto Agotado' : 'ğŸ›’ AÃ±adir al Carrito' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Shopping Cart Button -->
  <div class="cart-button" *ngIf="cart.length > 0">
    <button class="btn-cart" (click)="showCart = !showCart">
      ğŸ›’ Carrito ({{ cart.length }})
      <span class="cart-total">{{ cartTotal | currency:'EUR':'symbol':'1.2-2' }}</span>
    </button>
  </div>

  <!-- Cart Modal -->
  <div *ngIf="showCart" class="modal-overlay" (click)="showCart = false">
    <div class="modal-content cart-modal" (click)="$event.stopPropagation()">
      <h2>ğŸ›’ Mi Carrito</h2>
      
      <div *ngIf="cart.length === 0" class="empty-cart">
        El carrito estÃ¡ vacÃ­o
      </div>

      <div *ngIf="cart.length > 0" class="cart-items">
        <div *ngFor="let item of cart; let i = index" class="cart-item">
          <img [src]="item.product.image_url" [alt]="item.product.name">
          <div class="cart-item-info">
            <h4>{{ item.product.name }}</h4>
            <p>{{ item.product.price | currency:'EUR':'symbol':'1.2-2' }}</p>
          </div>
          <div class="cart-item-quantity">
            <button (click)="updateQuantity(i, item.quantity - 1)">-</button>
            <span>{{ item.quantity }}</span>
            <button (click)="updateQuantity(i, item.quantity + 1)">+</button>
          </div>
          <div class="cart-item-total">
            {{ (item.product.price * item.quantity) | currency:'EUR':'symbol':'1.2-2' }}
          </div>
          <button class="btn-remove" (click)="removeFromCart(i)">ğŸ—‘ï¸</button>
        </div>
      </div>

      <div *ngIf="cart.length > 0" class="cart-footer">
        <!-- Coupon Section -->
        <div class="cart-coupon-section">
          <h4>Â¿Tienes un cupÃ³n?</h4>
          
          <!-- Available Coupons for registered users -->
          <div *ngIf="currentUser && userCoupons.length > 0" class="available-coupons">
            <p class="coupons-title">ğŸ Tus cupones disponibles ({{ userCoupons.length }}):</p>
            <div class="coupons-grid">
              <div 
                *ngFor="let coupon of userCoupons" 
                class="coupon-card"
                (click)="applyUserCoupon(coupon.coupon_code)">
                <div class="coupon-card-header">
                  <span class="coupon-card-icon">ğŸŸï¸</span>
                  <span class="coupon-card-amount">â‚¬{{ coupon.discount_amount }}</span>
                </div>
                <div class="coupon-card-code">{{ coupon.coupon_code }}</div>
                <button class="btn-use-coupon">Usar CupÃ³n</button>
              </div>
            </div>
          </div>

          <!-- Applied Coupons List -->
          <div *ngIf="appliedCoupons.length > 0" class="applied-coupons-list">
            <p class="applied-title">âœ“ Cupones aplicados:</p>
            <div class="applied-coupons-items">
              <div *ngFor="let coupon of appliedCoupons" class="applied-coupon-item">
                <span class="applied-coupon-code">{{ coupon.code }}</span>
                <span class="applied-coupon-amount">-â‚¬{{ coupon.amount }}</span>
                <button class="btn-remove-applied" (click)="removeCoupon(coupon.code)">âœ–</button>
              </div>
            </div>
            <button class="btn-clear-all-coupons" (click)="removeAllCoupons()">
              Eliminar todos los cupones
            </button>
          </div>

          <!-- Manual coupon input -->
          <div class="coupon-input-section">
            <p class="input-label">Agregar otro cupÃ³n:</p>
            <div class="coupon-input-group">
              <input 
                type="text" 
                [(ngModel)]="couponCode" 
                placeholder="Ingresa tu cupÃ³n"
              >
              <button 
                class="btn-apply-coupon" 
                (click)="applyCoupon()"
                [disabled]="!couponCode"
              >
                Aplicar
              </button>
            </div>
          </div>
        </div>

        <!-- Total Section -->
        <div class="cart-total-section">
          <div class="total-line">
            <span>Subtotal:</span>
            <span>{{ cartSubtotal | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          <div *ngIf="currentUser" class="total-line discount">
            <span>ğŸ Descuento usuario (10%):</span>
            <span>-{{ cartDiscount | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          <div *ngIf="appliedCoupons.length > 0" class="total-line discount">
            <span>ğŸŸï¸ Cupones ({{ appliedCoupons.length }}):</span>
            <span>-{{ totalCouponDiscount | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          <div class="total-line total">
            <span><strong>Total:</strong></span>
            <span><strong>{{ cartTotal | currency:'EUR':'symbol':'1.2-2' }}</strong></span>
          </div>
          <div *ngIf="!currentUser" class="register-promo">
            ğŸ’¡ Â¡RegÃ­strate y obtÃ©n 10% de descuento en todas tus compras!
          </div>
        </div>

        <div class="cart-actions">
          <button class="btn-clear" (click)="clearCart()">Vaciar Carrito</button>
          <button class="btn-checkout" (click)="proceedToCheckout()">Proceder al Pago</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Modal -->
  <div *ngIf="showPaymentModal" class="modal-overlay" (click)="closePaymentModal()">
    <div class="payment-modal" (click)="$event.stopPropagation()">
      <div class="payment-header">
        <h2>ğŸ’³ MÃ©todo de Pago</h2>
        <button class="btn-close-modal" (click)="closePaymentModal()">âœ–</button>
      </div>

      <div class="payment-content">
        <!-- Order Summary -->
        <div class="order-summary">
          <h3>Resumen del Pedido</h3>
          <div class="summary-line">
            <span>Subtotal:</span>
            <span>{{ cartSubtotal | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          <div *ngIf="currentUser" class="summary-line discount">
            <span>Descuento usuario:</span>
            <span>-{{ cartDiscount | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          <div *ngIf="appliedCoupons.length > 0" class="summary-line discount">
            <span>Cupones ({{ appliedCoupons.length }}):</span>
            <span>-{{ totalCouponDiscount | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          <div class="summary-line total">
            <span><strong>Total a pagar:</strong></span>
            <span><strong>{{ cartTotal | currency:'EUR':'symbol':'1.2-2' }}</strong></span>
          </div>
        </div>

        <!-- Payment Methods -->
        <div class="payment-methods">
          <h3>Selecciona tu mÃ©todo de pago</h3>
          
          <div class="payment-options">
            <div 
              class="payment-option" 
              [class.selected]="paymentMethod === 'tarjeta'"
              (click)="selectPaymentMethod('tarjeta')">
              <div class="payment-icon">ğŸ’³</div>
              <div class="payment-info">
                <h4>Tarjeta de CrÃ©dito/DÃ©bito</h4>
                <p>Visa, Mastercard, American Express</p>
              </div>
              <div class="payment-check" *ngIf="paymentMethod === 'tarjeta'">âœ“</div>
            </div>

            <div 
              class="payment-option" 
              [class.selected]="paymentMethod === 'paypal'"
              (click)="selectPaymentMethod('paypal')">
              <div class="payment-icon">ğŸ…¿ï¸</div>
              <div class="payment-info">
                <h4>PayPal</h4>
                <p>Pago seguro con tu cuenta PayPal</p>
              </div>
              <div class="payment-check" *ngIf="paymentMethod === 'paypal'">âœ“</div>
            </div>

            <div 
              class="payment-option" 
              [class.selected]="paymentMethod === 'bizum'"
              (click)="selectPaymentMethod('bizum')">
              <div class="payment-icon">ğŸ“±</div>
              <div class="payment-info">
                <h4>Bizum</h4>
                <p>Pago instantÃ¡neo desde tu mÃ³vil</p>
              </div>
              <div class="payment-check" *ngIf="paymentMethod === 'bizum'">âœ“</div>
            </div>

            <div 
              class="payment-option" 
              [class.selected]="paymentMethod === 'efectivo'"
              (click)="selectPaymentMethod('efectivo')">
              <div class="payment-icon">ğŸ’µ</div>
              <div class="payment-info">
                <h4>Efectivo en Tienda</h4>
                <p>Paga al recoger tu pedido</p>
              </div>
              <div class="payment-check" *ngIf="paymentMethod === 'efectivo'">âœ“</div>
            </div>
          </div>
        </div>

        <!-- Pickup Points (only for cash payment) -->
        <div *ngIf="showPickupOptions" class="pickup-section">
          <h3>ğŸ“ Selecciona tu punto de recogida</h3>
          <p class="pickup-note">El pago en efectivo solo estÃ¡ disponible con recogida en tienda</p>
          
          <div class="pickup-options">
            <div 
              *ngFor="let point of pickupPoints"
              class="pickup-option"
              [class.selected]="pickupPoint === point"
              (click)="pickupPoint = point">
              <div class="pickup-icon">ğŸª</div>
              <div class="pickup-info">{{ point }}</div>
              <div class="pickup-check" *ngIf="pickupPoint === point">âœ“</div>
            </div>
          </div>
        </div>

        <!-- Confirm Button -->
        <div class="payment-actions">
          <button class="btn-cancel" (click)="closePaymentModal()">Cancelar</button>
          <button 
            class="btn-confirm-payment" 
            (click)="confirmPayment()"
            [disabled]="!paymentMethod || (paymentMethod === 'efectivo' && !pickupPoint)">
            Confirmar Pago
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Card Payment Modal -->
  <div *ngIf="showCardModal" class="modal-overlay" (click)="closeCardModal()">
    <div class="card-modal" (click)="$event.stopPropagation()">
      <div class="card-modal-header">
        <h2>ğŸ’³ Datos de la Tarjeta</h2>
        <button class="btn-close-modal" (click)="closeCardModal()">âœ–</button>
      </div>

      <div class="card-modal-content">
        <div class="card-preview">
          <div class="card-chip">ğŸ’³</div>
          <div class="card-number-display">{{ cardNumber || '**** **** **** ****' }}</div>
          <div class="card-details">
            <div class="card-holder-display">{{ cardHolder || 'TITULAR DE LA TARJETA' }}</div>
            <div class="card-expiry-display">{{ cardExpiry || 'MM/AA' }}</div>
          </div>
        </div>

        <form class="card-form">
          <div class="form-group">
            <label>NÃºmero de Tarjeta</label>
            <input 
              type="text" 
              [(ngModel)]="cardNumber"
              (input)="formatCardNumber($event)"
              placeholder="1234 5678 9012 3456"
              maxlength="16"
              name="cardNumber">
          </div>

          <div class="form-group">
            <label>Titular de la Tarjeta</label>
            <input 
              type="text" 
              [(ngModel)]="cardHolder"
              placeholder="NOMBRE COMPLETO"
              name="cardHolder"
              style="text-transform: uppercase;">
          </div>

          <div class="form-row-card">
            <div class="form-group">
              <label>Fecha de ExpiraciÃ³n</label>
              <input 
                type="text" 
                [(ngModel)]="cardExpiry"
                (input)="formatExpiry($event)"
                placeholder="MM/AA"
                maxlength="5"
                name="cardExpiry">
            </div>

            <div class="form-group">
              <label>CVV</label>
              <input 
                type="text" 
                [(ngModel)]="cardCVV"
                (input)="formatCVV($event)"
                placeholder="123"
                maxlength="3"
                name="cardCVV">
            </div>
          </div>

          <div class="card-modal-actions">
            <button type="button" class="btn-cancel" (click)="closeCardModal()">Cancelar</button>
            <button type="button" class="btn-confirm-card" (click)="confirmCardPayment()">
              Pagar {{ cartTotal | currency:'EUR':'symbol':'1.2-2' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Bizum Payment Modal -->
  <div *ngIf="showBizumModal" class="modal-overlay" (click)="closeBizumModal()">
    <div class="bizum-modal" (click)="$event.stopPropagation()">
      <div class="bizum-modal-header">
        <h2>ğŸ“± Pago con Bizum</h2>
        <button class="btn-close-modal" (click)="closeBizumModal()">âœ–</button>
      </div>

      <div class="bizum-modal-content">
        <div class="bizum-info">
          <div class="bizum-logo">ğŸ“±</div>
          <h3>Pago InstantÃ¡neo</h3>
          <p>Introduce tu nÃºmero de telÃ©fono asociado a Bizum</p>
          <div class="amount-display">
            {{ cartTotal | currency:'EUR':'symbol':'1.2-2' }}
          </div>
        </div>

        <form class="bizum-form">
          <div class="form-group">
            <label>NÃºmero de TelÃ©fono</label>
            <div class="phone-input-wrapper">
              <span class="phone-prefix">+34</span>
              <input 
                type="tel" 
                [(ngModel)]="bizumPhone"
                (input)="formatPhone($event)"
                placeholder="612 345 678"
                maxlength="9"
                name="bizumPhone">
            </div>
            <p class="input-hint">RecibirÃ¡s una notificaciÃ³n en tu mÃ³vil para confirmar el pago</p>
          </div>

          <div class="bizum-modal-actions">
            <button type="button" class="btn-cancel" (click)="closeBizumModal()">Cancelar</button>
            <button type="button" class="btn-confirm-bizum" (click)="confirmBizumPayment()">
              Enviar solicitud de pago
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-section">
        <h3>ğŸ›’ Tienda Online</h3>
        <p>Tu tienda de confianza para compras online. Calidad y servicio garantizados.</p>
        <div class="social-links">
          <a href="#" class="social-icon">ğŸ“˜</a>
          <a href="#" class="social-icon">ğŸ“·</a>
          <a href="#" class="social-icon">ğŸ¦</a>
          <a href="#" class="social-icon">ğŸ’¼</a>
        </div>
      </div>

      <div class="footer-section">
        <h3>Enlaces RÃ¡pidos</h3>
        <ul>
          <li><a routerLink="/home">Inicio</a></li>
          <li><a routerLink="/contact">Contacto</a></li>
          <li><a href="#">Sobre Nosotros</a></li>
          <li><a href="#">TÃ©rminos y Condiciones</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h3>AtenciÃ³n al Cliente</h3>
        <ul>
          <li><a href="#">Preguntas Frecuentes</a></li>
          <li><a href="#">EnvÃ­os y Devoluciones</a></li>
          <li><a href="#">PolÃ­tica de Privacidad</a></li>
          <li><a href="#">MÃ©todos de Pago</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h3>Contacto</h3>
        <ul class="contact-info">
          <li>ğŸ“ Calle Gran VÃ­a 28, Madrid</li>
          <li>ğŸ“ +34 900 123 456</li>
          <li>âœ‰ï¸ info&#64;tiendaonline.com</li>
          <li>ğŸ• Lun-Vie: 9:00 - 18:00</li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; 2025 Tienda Online. Todos los derechos reservados.</p>
      <div class="payment-methods">
        <span>ğŸ’³</span>
        <span>ğŸ…¿ï¸</span>
        <span>ğŸ“±</span>
        <span>ğŸ’µ</span>
      </div>
    </div>
  </footer>
</div>
